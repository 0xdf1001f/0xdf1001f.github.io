<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><title>ZProtect 1.4.9脱壳 | Wei's Blog</title><meta name="description" content="文章是在很久之前写的，突然发现新浪的外链全失效了，图片都消失了，重新修复了一下。憨憨新浪图床"><meta name="keywords" content="脱壳"><meta name="author" content="Yenn_"><meta name="copyright" content="Yenn_"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="ZProtect 1.4.9脱壳"><meta name="twitter:description" content="文章是在很久之前写的，突然发现新浪的外链全失效了，图片都消失了，重新修复了一下。憨憨新浪图床"><meta name="twitter:image" content="https://blog-1251128945.cos.ap-beijing.myqcloud.com/20201106201118.png"><meta property="og:type" content="article"><meta property="og:title" content="ZProtect 1.4.9脱壳"><meta property="og:url" content="https://0xdf1001f.github.io/2019/12/13/ZProtect-1-4-9%E8%84%B1%E5%A3%B3/"><meta property="og:site_name" content="Wei's Blog"><meta property="og:description" content="文章是在很久之前写的，突然发现新浪的外链全失效了，图片都消失了，重新修复了一下。憨憨新浪图床"><meta property="og:image" content="https://blog-1251128945.cos.ap-beijing.myqcloud.com/20201106201118.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = '2'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="https://0xdf1001f.github.io/2019/12/13/ZProtect-1-4-9%E8%84%B1%E5%A3%B3/"><link rel="prev" title="Github + jsDelivr提高博客加载速度" href="https://0xdf1001f.github.io/2020/03/19/Github-jsDelivr%E6%8F%90%E9%AB%98%E5%8D%9A%E5%AE%A2%E5%8A%A0%E8%BD%BD%E9%80%9F%E5%BA%A6/"><link rel="next" title="Windows下多种注入方法" href="https://0xdf1001f.github.io/2019/11/19/Windows%E4%B8%8B%E5%A4%9A%E7%A7%8D%E6%B3%A8%E5%85%A5%E6%96%B9%E6%B3%95/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: {"text":"富强,民主,文明,和谐,自由,平等,公正,法治,爱国,敬业,诚信,友善","fontSize":"15px"},
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  isHome: false,
  isPost: true
  
}</script><meta name="generator" content="Hexo 4.2.0"></head><body><header> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">Wei's Blog</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></span></div></header><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">31</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">15</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">6</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><div class="sidebar-toc__content"><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#ZProtect-脱壳"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">ZProtect 脱壳</span></a></li></ol></div></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#ZProtect-脱壳"><span class="toc-number">1.</span> <span class="toc-text">ZProtect 脱壳</span></a></li></ol></div></div></div><main id="content-outer"><div id="top-container" style="background-image: url(https://blog-1251128945.cos.ap-beijing.myqcloud.com/20201106201118.png)"><div id="post-info"><div id="post-title"><div class="posttitle">ZProtect 1.4.9脱壳</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 发表于 2019-12-13<span class="post-meta__separator">|</span><i class="fa fa-history fa-fw" aria-hidden="true"></i> 更新于 2020-11-13</time><span class="post-meta__separator">|</span><span><i class="fa fa-inbox post-meta__icon fa-fw" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E9%80%86%E5%90%91/">逆向</a><i class="fa fa-angle-right fa-fw" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon fa-fw" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E9%80%86%E5%90%91/%E8%84%B1%E5%A3%B3/">脱壳</a></span><div class="post-meta-wordcount"><i class="fa fa-file-word-o post-meta__icon fa-fw" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">873</span><span class="post-meta__separator">|</span><i class="fa fa-clock-o post-meta__icon fa-fw" aria-hidden="true"></i><span>阅读时长: 4 分钟</span><div class="post-meta-pv-cv"><span class="post-meta__separator">|</span><span><i class="fa fa-eye post-meta__icon fa-fw" aria-hidden="true"> </i>阅读量:</span><span id="busuanzi_value_page_pv"></span></div></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><h1 id="ZProtect-脱壳"><a href="#ZProtect-脱壳" class="headerlink" title="ZProtect 脱壳"></a>ZProtect 脱壳</h1><p>查壳, ZPotect 1.4.9</p>
<p><a href="https://blog-1251128945.cos.ap-beijing.myqcloud.com/83ccc6a5gy1g9uwapy86uj20g809mwf2.jpg" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="https://blog-1251128945.cos.ap-beijing.myqcloud.com/83ccc6a5gy1g9uwapy86uj20g809mwf2.jpg" class="lazyload"></a></p>
<p>拉进OD，F7单步，到push ad ESP定律下断，断下后单步几次，来到OEP</p>
<p><a href="https://blog-1251128945.cos.ap-beijing.myqcloud.com/83ccc6a5gy1g9uwc2hqfwj213k0he0ug.jpg" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="https://blog-1251128945.cos.ap-beijing.myqcloud.com/83ccc6a5gy1g9uwc2hqfwj213k0he0ug.jpg" class="lazyload"></a></p>
<p>记住OEP的地址4011A0</p>
<p>然后Ctrl+B，查找FF 15 或者FF 25，查找到一个CALL</p>
<p><a href="https://blog-1251128945.cos.ap-beijing.myqcloud.com/83ccc6a5gy1g9uwf4rpd1j20aa057glj.jpg" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="https://blog-1251128945.cos.ap-beijing.myqcloud.com/83ccc6a5gy1g9uwf4rpd1j20aa057glj.jpg" class="lazyload"></a></p>
<p><a href="https://blog-1251128945.cos.ap-beijing.myqcloud.com/83ccc6a5gy1g9uwfdbapmj212y064t8x.jpg" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="https://blog-1251128945.cos.ap-beijing.myqcloud.com/83ccc6a5gy1g9uwfdbapmj212y064t8x.jpg" class="lazyload"></a></p>
<p>回车进入CALL，长这样</p>
<p><a href="https://blog-1251128945.cos.ap-beijing.myqcloud.com/83ccc6a5gy1g9uwfsy1jrj213j0ejdgv.jpg" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="https://blog-1251128945.cos.ap-beijing.myqcloud.com/83ccc6a5gy1g9uwfsy1jrj213j0ejdgv.jpg" class="lazyload"></a></p>
<p>跟随第二行的jmp，到达后再回车进jmp</p>
<p><a href="https://blog-1251128945.cos.ap-beijing.myqcloud.com/83ccc6a5gy1g9uwgwqogmj213505swen.jpg" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="https://blog-1251128945.cos.ap-beijing.myqcloud.com/83ccc6a5gy1g9uwgwqogmj213505swen.jpg" class="lazyload"></a></p>
<p>到达后长这样</p>
<p><a href="https://blog-1251128945.cos.ap-beijing.myqcloud.com/83ccc6a5gy1g9uwhh2c4pj213j04ejrf.jpg" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="https://blog-1251128945.cos.ap-beijing.myqcloud.com/83ccc6a5gy1g9uwhh2c4pj213j04ejrf.jpg" class="lazyload"></a></p>
<p>回车跟进这个CALL</p>
<p><a href="https://blog-1251128945.cos.ap-beijing.myqcloud.com/83ccc6a5gy1g9uwi1owhzj213i0foab4.jpg" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="https://blog-1251128945.cos.ap-beijing.myqcloud.com/83ccc6a5gy1g9uwi1owhzj213i0foab4.jpg" class="lazyload"></a></p>
<p>找到ExitProcss下面的call，复制出来，记住CALL []内的地址 0x32652C</p>
<p><a href="https://blog-1251128945.cos.ap-beijing.myqcloud.com/83ccc6a5gy1g9uwj1475xj20ob04rwek.jpg" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="https://blog-1251128945.cos.ap-beijing.myqcloud.com/83ccc6a5gy1g9uwj1475xj20ob04rwek.jpg" class="lazyload"></a></p>
<p>然后Shift+*，回到EIP的位置，用ImportREC附加进程，查找IAT表，记下IAT的Start和End地址</p>
<p><a href="https://blog-1251128945.cos.ap-beijing.myqcloud.com/83ccc6a5gy1g9uwkvo2g8j20id0bwt97.jpg" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="https://blog-1251128945.cos.ap-beijing.myqcloud.com/83ccc6a5gy1g9uwkvo2g8j20id0bwt97.jpg" class="lazyload"></a></p>
<p>现在一共四个地址</p>
<p>OEP 0x4011A0</p>
<p>CALL [0x32652C]</p>
<p>IAT Start 408000</p>
<p>IAT End 4080E4<br>(这里在脚本中应该多写4字节，否则最后一个函数获取不到，所以应该写4080E8)</p>
<p>脚本代码：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">B8 00 80 40 00 8B 18 83 FB 00 74 36 80 3B 68 75 40 8B 4B 01 50 51 FF 15 2C 65 21 00 8B F0 A1 646C 21 00 2B 05 60 6C 21 00 C1 F8 02 3B F0 72 05 E8 E9 6A 8E FF A1 60 6C 21 00 8B 04 B0 5F 57 8907 58 83 C0 04 3D E8 80 40 00 72 B9 E9 35 4C FF FF 66 81 3B 50 60 75 EA 80 7B 02 68 75 E4 8B 4B03 EB B1</span><br></pre></td></tr></table></figure></div>

<p>在OEP往下拉，找到一片空白位置，写脚本</p>
<p>二进制粘贴</p>
<p><a href="https://blog-1251128945.cos.ap-beijing.myqcloud.com/83ccc6a5gy1g9uwopqmnoj20t60a00ti.jpg" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="https://blog-1251128945.cos.ap-beijing.myqcloud.com/83ccc6a5gy1g9uwopqmnoj20t60a00ti.jpg" class="lazyload"></a></p>
<p>粘贴好有时候第一行代码会变成</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">add byte ptr ds:[eax+0x408000],bh</span><br></pre></td></tr></table></figure></div>

<p>选中按下Ctrl+↑即可</p>
<p>粘贴后代码</p>
<p><a href="https://blog-1251128945.cos.ap-beijing.myqcloud.com/83ccc6a5gy1g9uwqkigavj21360e7dgo.jpg" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="https://blog-1251128945.cos.ap-beijing.myqcloud.com/83ccc6a5gy1g9uwqkigavj21360e7dgo.jpg" class="lazyload"></a></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">0040B9B0    B8 00804000     mov eax,HelloWor.00408000                ; IAT Start</span><br><span class="line">0040B9B5    8B18            mov ebx,dword ptr ds:[eax]</span><br><span class="line">0040B9B7    83FB 00         cmp ebx,0x0</span><br><span class="line">0040B9BA    74 36           je short HelloWor.0040B9F2</span><br><span class="line">0040B9BC    803B 68         cmp byte ptr ds:[ebx],0x68</span><br><span class="line">0040B9BF    75 40           jnz short HelloWor.0040BA01</span><br><span class="line">0040B9C1    8B4B 01         mov ecx,dword ptr ds:[ebx+0x1]</span><br><span class="line">0040B9C4    50              push eax                 ;kernel32.BaseThreadInitThunk</span><br><span class="line">0040B9C5    51              push ecx</span><br><span class="line">0040B9C6    FF15 2C652100   call dword ptr ds:[0x21652C];修改前几位不同位数，与CALL[]内地址相同</span><br><span class="line">0040B9CC    8BF0            mov esi,eax                              ; kernel32.BaseThreadInitThunk</span><br><span class="line">0040B9CE    A1 646C2100     mov eax,dword ptr ds:[0x216C64];修改前几位</span><br><span class="line">0040B9D3    2B05 606C2100   sub eax,dword ptr ds:[0x216C60];修改前几位</span><br><span class="line">0040B9D9    C1F8 02         sar eax,0x2</span><br><span class="line">0040B9DC    3BF0            cmp esi,eax                              ; kernel32.BaseThreadInitThunk</span><br><span class="line">0040B9DE    72 05           jb short HelloWor.0040B9E5</span><br><span class="line">0040B9E0    E8 E96A8EFF     call FFCF24CE</span><br><span class="line">0040B9E5    A1 606C2100     mov eax,dword ptr ds:[0x216C60];修改前几位</span><br><span class="line">0040B9EA    8B04B0          mov eax,dword ptr ds:[eax+esi*4]</span><br><span class="line">0040B9ED    5F              pop edi                                  ; kernel32.775FED6C</span><br><span class="line">0040B9EE    57              push edi</span><br><span class="line">0040B9EF    8907            mov dword ptr ds:[edi],eax               ; kernel32.BaseThreadInitThunk</span><br><span class="line">0040B9F1    58              pop eax                                  ; kernel32.775FED6C</span><br><span class="line">0040B9F2    83C0 04         add eax,0x4</span><br><span class="line">0040B9F5    3D E8804000     cmp eax,HelloWor.004080E8                ; IAT End</span><br><span class="line">0040B9FA  ^ 72 B9           jb short HelloWor.0040B9B5</span><br><span class="line">0040B9FC  ^ E9 9F57FFFF     jmp HelloWor.004011A0                    ; JMP OEP</span><br><span class="line">0040BA01    66:813B 5060    cmp word ptr ds:[ebx],0x6050</span><br><span class="line">0040BA06  ^ 75 EA           jnz short HelloWor.0040B9F2</span><br><span class="line">0040BA08    807B 02 68      cmp byte ptr ds:[ebx+0x2],0x68</span><br><span class="line">0040BA0C  ^ 75 E4           jnz short HelloWor.0040B9F2</span><br><span class="line">0040BA0E    8B4B 03         mov ecx,dword ptr ds:[ebx+0x3]</span><br><span class="line">0040BA11  ^ EB B1           jmp short HelloWor.0040B9C4</span><br></pre></td></tr></table></figure></div>

<p>如何修改CALL [ ]地址</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">kernel32.BaseThreadInitThunk</span><br><span class="line">0040B9C5    51              push ecx</span><br><span class="line">0040B9C6    FF15 2C652100   call dword ptr ds:[0x21652C];修改前几位不同位数，与CALL[]内地址相同</span><br><span class="line">0040B9CC    8BF0            mov esi,eax                              ; kernel32.BaseThreadInitThunk</span><br><span class="line">0040B9CE    A1 646C2100     mov eax,dword ptr ds:[0x216C64];修改前几位</span><br><span class="line">0040B9D3    2B05 606C2100   sub eax,dword ptr ds:[0x216C60];修改前几位</span><br><span class="line">0040B9D9    C1F8 02         sar eax,0x2</span><br><span class="line">0040B9DC    3BF0            cmp esi,eax                              ; kernel32.BaseThreadInitThunk</span><br><span class="line">0040B9DE    72 05           jb short HelloWor.0040B9E5</span><br><span class="line">0040B9E0    E8 E96A8EFF     call FFCF24CE</span><br><span class="line">0040B9E5    A1 606C2100     mov eax,dword ptr ds:[0x216C60];修改前几位</span><br></pre></td></tr></table></figure></div>

<p>比如40B9C6处为 CALL [0X21652C]，而前面跟随CALL获取到的为CALL [0x32652C]</p>
<p>只有前2位不同，所以只需将 [0X21652C]中的21改为32</p>
<p>然后将后面注释为“修改前几位”的数据，都将21修改为32，后面的数据不变</p>
<p>修改后为</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">0040B9C6    FF15 2C653200   call dword ptr ds:[0x32652C]</span><br><span class="line">0040B9CC    8BF0            mov esi,eax                              ; kernel32.BaseThreadInitThunk</span><br><span class="line">0040B9CE    A1 646C3200     mov eax,dword ptr ds:[0x326C64]</span><br><span class="line">0040B9D3    2B05 606C3200   sub eax,dword ptr ds:[0x326C60]</span><br><span class="line">0040B9D9    C1F8 02         sar eax,0x2</span><br><span class="line">0040B9DC    3BF0            cmp esi,eax                              ; kernel32.BaseThreadInitThunk</span><br><span class="line">0040B9DE    72 05           jb short HelloWor.0040B9E5</span><br><span class="line">0040B9E0    E8 E96A8EFF     call FFCF24CE</span><br><span class="line">0040B9E5    A1 606C3200     mov eax,dword ptr ds:[0x326C60]</span><br></pre></td></tr></table></figure></div>

<p>修改完成后，在脚本第一行新建EIP，取消ESP硬断</p>
<p><a href="https://blog-1251128945.cos.ap-beijing.myqcloud.com/83ccc6a5gy1g9ux0rb96jj213709ddgb.jpg" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="https://blog-1251128945.cos.ap-beijing.myqcloud.com/83ccc6a5gy1g9ux0rb96jj213709ddgb.jpg" class="lazyload"></a></p>
<p>在OEP处下断点，然后F9运行，断在OEP</p>
<p><a href="https://blog-1251128945.cos.ap-beijing.myqcloud.com/83ccc6a5gy1g9ux2qimtxj213g0ae3z6.jpg" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="https://blog-1251128945.cos.ap-beijing.myqcloud.com/83ccc6a5gy1g9ux2qimtxj213g0ae3z6.jpg" class="lazyload"></a></p>
<p>DUMP，ImportREC修复转储</p>
<p><a href="https://blog-1251128945.cos.ap-beijing.myqcloud.com/83ccc6a5gy1g9ux43ln7vj20iv0h2gnl.jpg" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="https://blog-1251128945.cos.ap-beijing.myqcloud.com/83ccc6a5gy1g9ux43ln7vj20iv0h2gnl.jpg" class="lazyload"></a></p>
<p><a href="https://blog-1251128945.cos.ap-beijing.myqcloud.com/83ccc6a5gy1g9ux4jd3bqj20fu0990tb.jpg" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="https://blog-1251128945.cos.ap-beijing.myqcloud.com/83ccc6a5gy1g9ux4jd3bqj20fu0990tb.jpg" class="lazyload"></a></p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Yenn_</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://0xdf1001f.github.io/2019/12/13/ZProtect-1-4-9%E8%84%B1%E5%A3%B3/">https://0xdf1001f.github.io/2019/12/13/ZProtect-1-4-9%E8%84%B1%E5%A3%B3/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://0xdf1001f.github.io">Wei's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E8%84%B1%E5%A3%B3/">脱壳    </a></div><div class="post_share"><div class="social-share" data-image="https://blog-1251128945.cos.ap-beijing.myqcloud.com/20201106201118.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020/03/19/Github-jsDelivr%E6%8F%90%E9%AB%98%E5%8D%9A%E5%AE%A2%E5%8A%A0%E8%BD%BD%E9%80%9F%E5%BA%A6/"><img class="prev_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/0xdf1001f/cdn@master/111.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>Github + jsDelivr提高博客加载速度</span></div></a></div><div class="next-post pull_right"><a href="/2019/11/19/Windows%E4%B8%8B%E5%A4%9A%E7%A7%8D%E6%B3%A8%E5%85%A5%E6%96%B9%E6%B3%95/"><img class="next_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/0xdf1001f/cdn@master/co2.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>Windows下多种注入方法</span></div></a></div></nav><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var notify = false == true ? true : false;
var verify = false == true ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;

window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'4iHpByXHTO1Rz8Jp7z1nJ211-gzGzoHsz',
  appKey:'dR4gLrc51geG7WX58ESN7dmJ',
  placeholder:'留个言再走⑧',
  avatar:'monsterid',
  guest_info:guest_info,
  pageSize:'10',
  lang:'zh-cn',
  recordIP: true
});</script></div></div></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2021 By Yenn_</div><div class="framework-info"><span>驱动 </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div><div class="footer_custom_text">阿炜's Blog</div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">简</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><script src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/js/ClickShowText.js"></script></body></html>